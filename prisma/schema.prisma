// Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                @id @default(autoincrement())
  name               String
  phone              String             @unique
  profilePhotoUrl    String?
  verificationStatus VerificationStatus @default(UNVERIFIED)
  pointsBalance      Int                @default(0)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  items              Item[]             @relation("UserItems")
  boughtTransactions Transaction[]      @relation("BuyerTransactions")
  soldTransactions   Transaction[]      @relation("SellerTransactions")
  pointsTransactions PointsTransaction[]
  verifications      Verification[]
}

model Item {
  id                  Int          @id @default(autoincrement()) // Changed from String to Int with autoincrement
  ownerId             Int          // Updated to match the new User id type
  owner               User         @relation("UserItems", fields: [ownerId], references: [id])
  title               String
  description         String
  brand               String?
  model               String?
  category            ItemCategory
  condition           ItemCondition
  ageYears            Int
  originalMsrp        Int
  estimatedMarketPrice Int
  pointsValue         Int
  accessoriesIncluded Json?
  images              Json
  locationPincode     String
  status              ItemStatus   @default(AVAILABLE)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  transaction         Transaction?
}

model Transaction {
  id                 Int          @id @default(autoincrement()) // Changed from String to Int with autoincrement
  buyerId            Int          // Updated to match the new User id type
  buyer              User         @relation("BuyerTransactions", fields: [buyerId], references: [id])
  sellerId           Int          // Updated to match the new User id type
  seller             User         @relation("SellerTransactions", fields: [sellerId], references: [id])
  itemId             Int @unique  // Updated to match the new Item id type
  item               Item         @relation(fields: [itemId], references: [id])
  pointsSpent        Int
  shippingCostPaid   Int
  status             TransactionStatus @default(PENDING)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model PointsTransaction {
  id            Int          @id @default(autoincrement()) // Changed from String to Int with autoincrement
  userId        Int          // Updated to match the new User id type
  user          User         @relation(fields: [userId], references: [id])
  type          PointsChangeType
  pointsChange  Int
  source        String?
  createdAt     DateTime     @default(now())
}

model Verification {
  id         Int          @id @default(autoincrement()) // Changed from String to Int with autoincrement
  userId     Int          // Updated to match the new User id type
  user       User         @relation(fields: [userId], references: [id])
  method     VerificationMethod
  status     VerificationStatus
  documentUrl String?
  createdAt  DateTime     @default(now())
}

// ENUMS
enum VerificationStatus {
  UNVERIFIED
  EMAIL_VERIFIED
  ID_VERIFIED
}

enum VerificationMethod {
  EMAIL
  PHONE
  GOVERNMENT_ID
}

enum ItemCategory {
  PHONE
  LAPTOP
  TABLET
  ACCESSORIES
  OTHER
}

enum ItemCondition {
  LIKE_NEW
  GOOD
  FAIR
  POOR
  BROKEN
}

enum ItemStatus {
  AVAILABLE
  RESERVED
  SHIPPED
  COMPLETED
  CANCELED
}

enum TransactionStatus {
  PENDING
  SHIPPING_IN_PROGRESS
  COMPLETED
  CANCELED
}

enum PointsChangeType {
  EARN
  SPEND
  BONUS
  PURCHASE
}
